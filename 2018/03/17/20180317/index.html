<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description"><meta name="keywords" content="Hexo, Gruntjs, Nodejs, Reactjs, Vuejs"><title>MySQL中的共享锁与排他锁 - rivers &amp; lakes</title><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="/image/stef.ico"></head><body><input id="navi" type="checkbox"><ul class="main-navication"><li><a href="/"><span>Home</span></a></li><li><a href="https://github.com"><span>Github</span></a></li></ul><div class="wrapper" id="wrap"><div class="post-header"><label class="navi-button light" for="navi">MENU</label><img class="background" src="/image/page_background.jpg"><div class="post-title"><h1 class="title">MySQL中的共享锁与排他锁</h1><ul class="meta"><li><i class="icon icon-author"></i>大米粥科技的小伙伴</li><li><i class="icon icon-clock"></i>1 Minutes</li><li><i class="icon icon-calendar"></i>March 17, 2018</li></ul></div></div><div class="article-content" style="max-width:800px"><p><br><font color="#ff0044" size="3.5" face="Times New Roman">MySQL中的共享锁与排他锁</font><br></p><br>—————-<br><font color="#000000" size="3.5" face="MV Boli">jiawei</font><br><a id="more"></a><br><br>行级锁是Mysql中锁定粒度最细的一种锁，行级锁能大大减少数据库操作的冲突。<br>行级锁分为共享锁和排他锁两种.<br><font color="#ff0044" size="3.5" face="Times New Roman">共享锁/Share Lock</font><br>共享锁又称读锁，是读取操作创建的锁。其他用户可以并发读取数据，但任何事务都不能对数据进行修改（获取数据上的排他锁），直到已释放所有共享锁。<br>如果事务T对数据A加上共享锁后，则其他事务只能对A再加共享锁，不能加排他锁。获准共享锁的事务只能读数据，不能修改数据。<br>用法<br>SELECT … LOCK IN SHARE MODE;<br>在查询语句后面增加LOCK IN SHARE MODE，Mysql会对查询结果中的每行都加共享锁，当没有其他线程对查询结果集中的任何一行使用排他锁时，可以成功申请共享锁，否则会被阻塞。其他线程也可以读取使用了共享锁的表，而且这些线程读取的是同一个版本的数据。<br><br><font color="#ff0044" size="3.5" face="Times New Roman">排他锁/eXclusive Lock</font><br>共享锁又称写锁，如果事务T对数据A加上排他锁后，则其他事务不能再对A加任任何类型的封锁。获准排他锁的事务既能读数据，又能修改数据。<br>用法<br>SELECT … FOR UPDATE;<br>在查询语句后面增加FOR UPDATE，Mysql会对查询结果中的每行都加排他锁，当没有其他线程对查询结果集中的任何一行使用排他锁时，可以成功申请排他锁，否则会被阻塞。<br><br><font color="#ff0044" size="3.5" face="Times New Roman">意向锁</font><br>InnoDB还有两个表锁：<br>意向共享锁（IS）：表示事务准备给数据行加入共享锁，也就是说一个数据行加共享锁前必须先取得该表的IS锁<br>意向排他锁（IX）：类似上面，表示事务准备给数据行加入排他锁，说明事务在一个数据行加排他锁前必须先取得该表的IX锁。<br>意向锁是InnoDB自动加的，不需要用户干预。<br>对于insert、update、delete，InnoDB会自动给涉及的数据加排他锁（X）；对于一般的Select语句，InnoDB不会加任何锁，事务可以通过以下语句给显示加共享锁或排他锁。<br>共享锁：SELECT … LOCK IN SHARE MODE;<br>排他锁：SELECT … FOR UPDATE;<br><br><p></p>
</div><div class="article-meta" style="max-width:800px"></div><div class="article-comment" style="max-width:800px"><div class="ds-thread" id="ds-thread" data-thread-key="cjlp1oq650005k8ucq3jffqvy" data-title="MySQL中的共享锁与排他锁" data-url="http://yoursite.com/2018/03/17/20180317/" site-name="ueibo"></div><script>var siteName = document.getElementById('ds-thread').getAttribute('site-name');
var duoshuoQuery = {short_name: siteName};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
  || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script></div><ul class="navication"><li class="home"><a href="/"><i class="icon icon-home"></i></a></li><li><a href="/2018/03/31/20180331/"><i class="icon icon-arror-left"></i></a></li><li><a href="/2018/03/03/20180303/"><i class="icon icon-arror-right"></i></a></li></ul><div class="page-footer"><div class="top"><ul class="social"><li><a href="https://github.com/stef24" title="Github" target="_blank"><i class="icon icon-github"></i></a></li></ul></div><div class="bottom"><p class="copyright">© 2018 rivers &amp; lakes<br><small>POWER BY <a href="https://hexo.io" target="_blank">HEXO</a></small></p></div></div></div><script>var wrap = document.getElementById('wrap');
window.onload = function () {
  wrap.className += ' done';
}</script></body></html>