<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description"><meta name="keywords" content="Hexo, Gruntjs, Nodejs, Reactjs, Vuejs"><title>Mysql中的行级锁/表级锁/页级锁 - rivers &amp; lakes</title><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="/image/stef.ico"></head><body><input id="navi" type="checkbox"><ul class="main-navication"><li><a href="/"><span>Home</span></a></li><li><a href="https://github.com"><span>Github</span></a></li></ul><div class="wrapper" id="wrap"><div class="post-header"><label class="navi-button light" for="navi">MENU</label><img class="background" src="/image/page_background.jpg"><div class="post-title"><h1 class="title">Mysql中的行级锁/表级锁/页级锁</h1><ul class="meta"><li><i class="icon icon-author"></i>jiawei</li><li><i class="icon icon-clock"></i>2 Minutes</li><li><i class="icon icon-calendar"></i>February 3, 2018</li></ul></div></div><div class="article-content" style="max-width:800px"><p><br><font color="#ff0044" size="3.5" face="Times New Roman">Mysql中的行级锁/表级锁/页级锁</font><br></p><br>—————-<br><font color="#000000" size="3.5" face="MV Boli">jiawei</font><br><a id="more"></a><br><br>在计算机科学中，锁是在执行多线程时用于强行限制资源访问的同步机制，即用于在并发控制中保证对互斥要求的满足。<br>在数据库的锁机制中，DBMS中，可以按照锁的粒度把数据库锁分为行级锁(INNODB引擎)、表级锁(MYISAM引擎)和页级锁(BDB引擎)。<br><font color="#ff0044" size="3.5" face="Times New Roman">行级锁</font><br>行级锁是Mysql中锁定粒度最细的一种锁，表示只针对当前操作的行进行加锁。<br>行级锁能大大减少数据库操作的冲突。其加锁粒度最小，但加锁的开销也最大。行级锁分为共享锁和排他锁。<br>特点:开销大，加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率最低，并发度也最高。<br><font color="#ff0044" size="3.5" face="Times New Roman">表级锁</font><br>表级锁是MySQL中锁定粒度最大的一种锁，表示对当前操作的整张表加锁，它实现简单，资源消耗较少，被大部分MySQL引擎支持。<br>最常使用的MYISAM与INNODB都支持表级锁定。表级锁定分为表共享读锁（共享锁）与表独占写锁（排他锁）。<br>特点:开销小，加锁快；不会出现死锁；锁定粒度大，发出锁冲突的概率最高，并发度最低。<br><font color="#ff0044" size="3.5" face="Times New Roman">页级锁</font><br>表级锁是MySQL中锁定粒度介于行级锁和表级锁中间的一种锁.表级锁速度快，但冲突多，行级冲突少，但速度慢。<br>所以取了折衷的页级，一次锁定相邻的一组记录。BDB支持页级锁。<br>特点:开销和加锁时间界于表锁和行锁之间；会出现死锁；锁定粒度界于表锁和行锁之间，并发度一般。<br><br><font color="#ff0044" size="3.5" face="Times New Roman">MySQL常用存储引擎的锁机制</font><br>MyISAM和MEMORY采用表级锁(table-level locking)<br>BDB采用页面锁(page-level locking)或表级锁，默认为页面锁<br>InnoDB支持行级锁(row-level locking)和表级锁,默认为行级锁<br>Innodb中的行锁与表锁<br>InnoDB行锁是通过给索引上的索引项加锁来实现的，这一点MySQL与Oracle不同，后者是通过在数据块中对相应数据行加锁来实现的。<br>InnoDB这种行锁实现特点意味着：只有通过索引条件检索数据，InnoDB才使用行级锁，否则，InnoDB将使用表锁！<br>在实际应用中，要特别注意InnoDB行锁的这一特性，不然的话，可能导致大量的锁冲突，从而影响并发性能。<br>行级锁都是基于索引的，如果一条SQL语句用不到索引是不会使用行级锁的，会使用表级锁。行级锁的缺点是：由于需要请求大量的锁资源，所以速度慢，内存消耗大。<br>行级锁与死锁<br>MyISAM中是不会产生死锁的，因为MyISAM总是一次性获得所需的全部锁，要么全部满足，要么全部等待。而在InnoDB中，锁是逐步获得的，就造成了死锁的可能。<br>在MySQL中，行级锁并不是直接锁记录，而是锁索引。<br>索引分为主键索引和非主键索引两种:<br>如果一条sql语句操作了主键索引，MySQL就会锁定这条主键索引；<br>如果一条语句操作了非主键索引，MySQL会先锁定该非主键索引，再锁定相关的主键索引。<br>在UPDATE、DELETE操作时，MySQL不仅锁定WHERE条件扫描过的所有索引记录，而且会锁定相邻的键值，即所谓的next-key locking。<br>当两个事务同时执行，一个锁住了逐渐索引在等待其他相关索引，一个锁定了非主键索引，在等待主键索引。这样就会发生死锁。<br>发生死锁后，InnoDB一般都可以检测到，并使一个事务释放锁回退，另一个获取锁完成事务。<br><br><font color="#93C572" size="3.0" face="Times New Roman"><br>常见的三种避免死锁方法：<br>1、如果不同程序会并发存取多个表，尽量约定以相同的顺序访问表，可以大大降低死锁机会。<br>2、在同一个事务中，尽可能做到一次锁定所需要的所有资源，减少死锁产生概率；<br>3、对于非常容易产生死锁的业务部分，可以尝试使用升级锁定颗粒度，通过表级锁定来减少死锁产生的概率；<br></font><br><br><p></p>

</div><div class="article-meta" style="max-width:800px"></div><div class="article-comment" style="max-width:800px"><div class="ds-thread" id="ds-thread" data-thread-key="cjlneasst00008sucy2nmd4hu" data-title="Mysql中的行级锁/表级锁/页级锁" data-url="http://yoursite.com/2018/02/03/20180203/"></div><script>var siteName = document.getElementById('ds-thread').getAttribute('site-name');
var duoshuoQuery = {short_name: siteName};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
  || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script></div><ul class="navication"><li class="home"><a href="/"><i class="icon icon-home"></i></a></li><li><a href="/2018/02/14/20180214/"><i class="icon icon-arror-left"></i></a></li><li><a href="/2018/01/24/20180124/"><i class="icon icon-arror-right"></i></a></li></ul><div class="page-footer"><div class="top"><ul class="social"><li><a href="https://github.com/stef24" title="Github" target="_blank"><i class="icon icon-github"></i></a></li></ul></div><div class="bottom"><p class="copyright">© 2018 rivers &amp; lakes<br><small>POWER BY <a href="https://hexo.io" target="_blank">HEXO</a></small></p></div></div></div><script>var wrap = document.getElementById('wrap');
window.onload = function () {
  wrap.className += ' done';
}</script></body></html>